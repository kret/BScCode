(function(){var a={};a.mouseButtonPressed=function(d){d.toggleClass("click")};a.mouseButtonReleased=function(d){d.toggleClass("click")};a.changeState=function(f,e,d){f.toggleClass("selected",d);e.attr("checked",d)};a.showPreloader=function(d){if(d){d.append('<div class=preloader style="width: '+d.width()+"px; height: "+d.height()+'px;"></div>')}else{jQuery(".preloader").fadeIn()}};a.hidePreloader=function(){jQuery(".preloader").fadeOut("slow")};a.showError=function(e,d){a.hidePreloader();var f="";switch(e){case 503:f="Wystąpił błąd komunikacji."}if(d){d.append('<div class=download-error style="width: '+d.width()+"px; height: "+d.height()+'px;">'+f+"</div>")}};var c=function(e){var d=this;a.showPreloader(d.parent());console.log("cccccc");$.ajax({type:"POST",url:"/books/"+bookId+"/get_preferences",dataType:"json",success:function(f){f=f.preferences;d.each(function(){var h=jQuery(this);var j=jQuery("#"+h.attr("for"));var i=j.attr("name");var g=(j.attr("value")==="true");if(f[i]===g){a.changeState(h,j,true)}h.mousedown(function(){a.mouseButtonPressed(h)}).mouseup(function(){a.mouseButtonReleased(h)});j.change(function(){a.showPreloader();var n=$(this).is(":checked");var l=$("label[for="+i+"_"+!g+"]");var k=$("input[id="+i+"_"+!g+"]");var m=k.is(":checked");a.changeState(h,j,n);if(n&&m){a.changeState(l,k,false)}controler.saveData(i,{val:g,state:n},{val:!g,state:k.is(":checked")})})});a.hidePreloader()},error:function(g,i,h,f){a.showError(g.status,d.parent())}})};controler={};controler.saveData=function(f,e,h){var d=null;console.log(f,e.val,e.state,h.val,h.state,(e.state&h.state),(e.state&&h.state));if(e.state===true){d=e.val}else{if(h.state===true){d=h.val}}var g={};g[f]=d;$.ajax({type:"POST",url:"/books/"+bookId+"/set_preferences",data:"preferences="+JSON.stringify(g),success:function(i){a.hidePreloader()},error:function(j,l,k,i){}})};var b={};$.fn.toggleButton=function(d){if(b[d]){return b[d].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof d==="object"||!d){return c.apply(this,arguments)}}}})();jQuery(".tag").toggleButton();