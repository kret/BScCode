(function(c,b){var d=c("#dialog").dialog({autoOpen:false,modal:true,buttons:{Dodaj:function(){var g=jQuery("#name").val(),h=jQuery("#lastname").val();c.ajax({type:"POST",url:"/people.json",data:{"person[first_name]":g,"person[last_name]":h},success:function(j,i,l,k){c("<li id=person-"+j.person.id+">"+j.person.first_name+" "+j.person.last_name+"<a class=delete>x</a></li>").appendTo("#book-author-details-list")},error:function(i){b.alert("error",i)}});c(this).dialog("close")}}});var a={getAll:function(){console.log(this.data("add_autor")?this.data("add_autor").autors:[]);return this.data("add_autor")?this.data("add_autor").autors:[]},remove:function(i){var h=this.data("add_autor").autors,g=c("#author-"+i);this.data("add_autor",{autors:h.remove(i)});g.fadeOut(function(){g.remove()})}};var f=function(){var g=this;var h=function(j,l){var i=g.data("add_autor")?g.data("add_autor").autors:[],k=c("<li id=author-"+l+">"+j+'<a href="#delete" class=delete>x</a></li>');i.push(l);g.data("add_autor",{autors:i});k.appendTo("#book-author-details-list").find(".delete").bind("click",function(){g.autors("remove",l,g)})};g.autocomplete({minLength:3,select:function(i,j){if(j.item.id){h(j.item.label,j.item.id)}else{d.dialog("open")}},close:function(){g.val("")},source:function(j,i){c.ajax({url:"/people/autocomplete_person_last_name",dataType:"json",data:{term:j.term},success:function(k){if(k.length===0){i([{id:null,label:"Dodaj nową osobę..."}])}else{i(k)}},error:function(l,o,n,k){b.alert("error",e);g.attr("disabled",true)}})}});return this};c.fn.autors=function(g){if(a[g]){return a[g].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof g==="object"||!g){return f.apply(this,arguments)}}};Array.prototype.remove=function(g){return this.splice(this.indexOf(g),1)}})(jQuery,alert);